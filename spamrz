-- SERVICES
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

repeat task.wait() until LocalPlayer:FindFirstChild("PlayerGui")

-- CONFIG
local TITLE_TEXT = "4strxl spamrz"
local COMMANDS = {
    ";rocket",
    ";balloon",
    ";tiny",
    ";inverse",
    ";morph",
    ";jumpscare"
}

local JAIL_DELAY = 0.6
local RAGDOLL_DELAY = 1.2

-- COLORS
local BG = Color3.fromRGB(255,255,255)
local PURPLE = Color3.fromRGB(190,160,255)
local PURPLE_DARK = Color3.fromRGB(160,130,220)
local BTN = PURPLE
local BTN_HOVER = PURPLE_DARK

-- NOTIFY
local function notify(t,d)
    pcall(function()
        StarterGui:SetCore("SendNotification",{
            Title = t,
            Text = d,
            Duration = 3
        })
    end)
end

-- CHAT SENDER
local function sendChat(msg)
    if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
        local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
        if channel then
            channel:SendAsync(msg)
        end
    else
        ReplicatedStorage
            :WaitForChild("DefaultChatSystemChatEvents")
            :WaitForChild("SayMessageRequest")
            :FireServer(msg,"All")
    end
end

-- MAX-SPEED LEGAL CHAT QUEUE
local ChatQueue = {}
local sending = false

local function processQueue()
    if sending then return end
    sending = true

    task.spawn(function()
        while #ChatQueue > 0 do
            local msg = table.remove(ChatQueue,1)
            sendChat(msg)

            -- wait until Roblox allows next message (legal)
            repeat task.wait() until pcall(function()
                sendChat("") -- permission probe, no visible spam
            end)
        end
        sending = false
    end)
end

local function queueChat(msg)
    table.insert(ChatQueue,msg)
    processQueue()
end

-- CLEAN OLD GUI
pcall(function()
    local old = LocalPlayer.PlayerGui:FindFirstChild("4strxl_spamz_gui")
    if old then old:Destroy() end
end)

-- GUI ROOT
local gui = Instance.new("ScreenGui",LocalPlayer.PlayerGui)
gui.Name = "4strxl_spamz_gui"
gui.ResetOnSpawn = false

local main = Instance.new("Frame",gui)
main.Size = UDim2.fromOffset(300,380)
main.Position = UDim2.fromOffset(100,100)
main.BackgroundColor3 = BG
main.BorderSizePixel = 0
Instance.new("UICorner",main).CornerRadius = UDim.new(0,14)

local stroke = Instance.new("UIStroke",main)
stroke.Color = PURPLE
stroke.Transparency = 0.25

-- TOP BAR
local top = Instance.new("Frame",main)
top.Size = UDim2.new(1,0,0,38)
top.BackgroundColor3 = PURPLE
top.BorderSizePixel = 0
Instance.new("UICorner",top).CornerRadius = UDim.new(0,14)

local title = Instance.new("TextLabel",top)
title.Size = UDim2.new(1,-90,1,0)
title.Position = UDim2.fromOffset(10,0)
title.BackgroundTransparency = 1
title.Text = TITLE_TEXT
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextColor3 = Color3.fromRGB(245,245,245)

-- REFRESH BUTTON
local refresh = Instance.new("TextButton", top)
refresh.Size = UDim2.fromOffset(78,26)
refresh.Position = UDim2.new(1,-84,0,6)
refresh.Text = "Refresh"
refresh.Font = Enum.Font.Gotham
refresh.TextSize = 14
refresh.TextColor3 = Color3.fromRGB(255,255,255)
refresh.BackgroundColor3 = PURPLE_DARK
refresh.BorderSizePixel = 0
Instance.new("UICorner", refresh).CornerRadius = UDim.new(0,8)

-- MINIMIZE BUTTON
local minBtn = Instance.new("TextButton", top)
minBtn.Size = UDim2.fromOffset(28,26)
minBtn.Position = UDim2.new(1,-30,0,6)
minBtn.Text = "_"
minBtn.Font = Enum.Font.Gotham
minBtn.TextSize = 18
minBtn.TextColor3 = Color3.fromRGB(255,255,255)
minBtn.BackgroundColor3 = PURPLE_DARK
minBtn.BorderSizePixel = 0
Instance.new("UICorner", minBtn).CornerRadius = UDim.new(0,8)

-- MINIMIZE FUNCTION
local minimized = false
minBtn.Activated:Connect(function()
    minimized = not minimized
    if minimized then
        holder.Visible = false
        main.Size = UDim2.fromOffset(300,38)
    else
        holder.Visible = true
        main.Size = UDim2.fromOffset(300,380)
    end
end)

-- DRAGGING
do
    local dragging, dragStart, startPos
    top.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = i.Position
            startPos = main.Position
            i.Changed:Connect(function()
                if i.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    top.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = i.Position - dragStart
            main.Position = UDim2.fromOffset(
                startPos.X.Offset + delta.X,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- CONTENT
local holder = Instance.new("Frame",main)
holder.Position = UDim2.fromOffset(8,46)
holder.Size = UDim2.new(1,-16,1,-54)
holder.BackgroundTransparency = 1

local list = Instance.new("ScrollingFrame",holder)
list.Size = UDim2.fromScale(1,1)
list.CanvasSize = UDim2.new()
list.ScrollBarThickness = 6
list.BackgroundTransparency = 1
list.BorderSizePixel = 0

local layout = Instance.new("UIListLayout",list)
layout.Padding = UDim.new(0,6)

-- SESSION TARGET
local lastTarget
local trackedPlayers = {}

-- Track player for jail/ragdoll after respawn
local function trackPlayer(plr)
    if trackedPlayers[plr] then return end
    trackedPlayers[plr] = true

    local function onChar(char)
        local hum = char:WaitForChild("Humanoid",5)
        if not hum then return end

        hum.Died:Once(function()
            plr.CharacterAdded:Wait()
            if lastTarget == plr then
                task.delay(JAIL_DELAY,function()
                    queueChat(";jail "..plr.Name)
                end)
                task.delay(RAGDOLL_DELAY,function()
                    queueChat(";ragdoll "..plr.Name)
                end)
            end
        end)
    end

    if plr.Character then
        onChar(plr.Character)
    end
    plr.CharacterAdded:Connect(onChar)
end

-- SPAM FUNCTION
local function spamPlayer(plr)
    lastTarget = plr

    for _, cmd in ipairs(COMMANDS) do
        queueChat(cmd.." "..plr.Name)
    end

    notify("Sent","Max-speed spam @"..plr.Name)

    -- Track for jail/ragdoll
    trackPlayer(plr)
end

-- BUTTON CREATOR
local function spamButton(plr)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(1,-6,0,34)
    b.Text = " @"..plr.Name
    b.TextXAlignment = Enum.TextXAlignment.Left
    b.Font = Enum.Font.Gotham
    b.TextSize = 14
    b.TextColor3 = Color3.fromRGB(20,20,20)
    b.BackgroundColor3 = BTN
    b.BorderSizePixel = 0
    Instance.new("UICorner",b).CornerRadius = UDim.new(0,8)

    b.MouseEnter:Connect(function() b.BackgroundColor3 = BTN_HOVER end)
    b.MouseLeave:Connect(function() b.BackgroundColor3 = BTN end)
    b.Activated:Connect(function() spamPlayer(plr) end)

    return b
end

-- REFRESH LIST
local function refreshList()
    for _,v in ipairs(list:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end

    for _,p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            spamButton(p).Parent = list
        end
    end

    task.wait()
    list.CanvasSize = UDim2.fromOffset(0,layout.AbsoluteContentSize.Y+10)
end

Players.PlayerAdded:Connect(refreshList)
Players.PlayerRemoving:Connect(refreshList)

refresh.MouseButton1Click:Connect(refreshList)

refreshList()
notify(TITLE_TEXT,"Hub loaded successfully")
